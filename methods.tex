\chapter{A new device to record wrist movement in free living humans}
\label{Chap:Methods}

Our planned device design for the all day wrist motion activity tracker revolves around a system of sensors that are polled at 15Hz by a microcontroller. This data is logged throughout the day, after which it is transferred to a computer for processing. Once the data for a day has been logged, the device is connected to a computer and data from the memory chip is dumped to a computer where it can be analyzed. As all this happens throughout the day, we need some kind of display to inform the user of the status of the device.

To create the prototype device, different prototype breakout boards were used (section~\ref{Sec:Breakouts}). These boards allow rapid prototyping by hooking up components using wires. This reduces any time spent to solder an integrated circuit to a PCB or to understand its typical application circuit components. Next, we consider the different devices used to create our wrist motion activity tracker. We would need a power source in the form of a battery (section~\ref{Sec:Battery}), sensors to measure acceleration (section~\ref{Sec:Accelerometer}) and angular velocity(section~\ref{Sec:Gyroscope}), a memory chip (section~\ref{Sec:Memory}) to store data from the sensors and a microcontroller (section~\ref{Sec:MicroController}) to control this system and act as a communication channel between the different devices. To connect this device to a computer, we would need a translator. We use a USB to UART bridge (section~\ref{Sec:FT232}) to accomplish this.

With all these components available, we would have to connect them together correctly, which is explaining in the Circuit design section (\ref{Sec:CircuitDesign}). Once the design has been tested, it is laid out as a PCB design using EAGLE PCB, and then fabricated. This PCB would then need the IC's soldered to it, and we discuss the two methods used to do so (section~\ref{Sec:Soldering}).

We recap that we have two strong requirements for our device, and all hardware decisions must consider these:
\begin{itemize}
  \item Device Size
  \item Device Power Consumption
\end{itemize}

Throughout this document,
we provide photographs of the different components used in creating our wrist activity monitor.
These parts are very small in size,
and to emphasize this,
we show a coin,
the standard US quarter next to the part being discussed for comparison.
This will hopefully give the reader a better idea of the scale of devices we are working with.
Remembering that device size and power consumption are very important,
we look at the different hardware in our device in the next section.

\section{Sensors}
Since we want to log acceleration and rotation data,
we consider the different sensors available in the market and their sizes.
At the time of writing this thesis, the leader in this field was a category of sensors called MEMS sensors.
Micro-electro-mechanical-system based sensors are small devices
ranging from about 4 mm\textsuperscript{2} to  25 mm\textsuperscript{2}.
Our device design uses an MEMS gyroscope and accelerometer in a single electronic chip to sense movements.
This chips may also be called the IMU or the Inertial Measurement Unit.
The orientation and axes for this chip when it is worn on the wrist as a part of our final device is shown in figure \ref{fig:HandAxis}.

\section{Accelerometers}
\label{Sec:Accelerometer}
Accelerometers are devices that sense linear acceleration.
In the case of our device we have to measure the linear acceleration in all three Cartesian coordinate axes: X, Y, and Z.
This will allow us to track the movement of the wrist in free living humans as their hand moves around in free space.
Figure \ref{fig:HandAxis} shows how the axis of the sensor are oriented for our device when worn on the wrist.
To understand how an accelerometer works,
we imagine a system devised of a spring connected to a fixed surface at one end,
and an object with a mass M at the other end. This is shown in figure \ref{fig:HookeSpring}.
The equilibrium point 0 and extended distance X is also shown.
Since springs are governed by Hooke's Law, we can use this law to explain the behavior of our system.
Hooke's law states that to extend or compress a spring by distance X,
the force required is proportional to X, or mathematically as given in equation \ref{Eqn:HookesLaw}:
\begin{equation}
\label{Eqn:HookesLaw}
F = -kX 
\end{equation}
where F is the force required, X is the distance the spring is extended or compressed from its equilibrium position, and k is the spring constant for a particular spring.
\begin{figure}
\begin{center}
\includegraphics{images/HookesLaw.eps}
\caption{Example of a spring with spring constant k, displaced from its equilibrium 0 by X}
\label{fig:HookeSpring}
\end{center}
\end{figure}

\hfill \\
We also have Newton's Second Law of Motion
which states that the force applied on a body with constant mass produces a proportional acceleration.
Mathematically, Newton's Second Law of motion can be expressed as given in equation \ref{Eqn:Newtons2ndLaw}:
\begin{equation}
\label{Eqn:Newtons2ndLaw}
F = ma 
\end{equation}
where F is the force, m is the mass of the body, and a is the acceleration produced. Combining the two equations, we can solve for acceleration using the result in equation \ref{Eqn:HookeAcc}.
\begin{equation}
\label{Eqn:HookeAcc}
a = \frac{-kX}{m} 
\end{equation}
However, consider the fact that the spring constant k and mass m are constant in the equation above, which means that acceleration a is inversely proportional to the displacement X. Because of this fact, new MEMS accelerometers are very simple systems consisting of small mechanical parts that measure the displacement and output the value of the acceleration measured based on this displacement.
Something that we must note is that since the sensor is measuring force, that gravity is always acting on the device,
and due to this, a reading of 1g will always be read on the Z axis in the ``earth'' system.
If there is no motion, we can empirically know which direction gravitational force is acting in by looking at the sensed data,
and can subtract this from later readings obtained from the accelerometer.

\section{Gyroscopes}
\label{Sec:Gyroscope}

Gyroscopes are devices used to measure angular movement. In our case, we use MEMS gyroscopes to measure angular velocity in three axes, X, Y and Z (as shown in figure \ref{fig:HandAxis}). How a gyroscope works is explained in a Sparkfun tutorial~\cite{Web:SparkfunGyros}. We will review the same here.
\begin{figure}
\begin{center}
\includegraphics{images/GyroWork.eps}
\caption{Internal working of a gyroscope}
\label{fig:GyroDiag}
\end{center}
\end{figure}

An MEMS gyroscope contains a small mass that oscillates inside it as shown in figure \ref{fig:GyroDiag}. When the gyroscope rotates, the oscillating mass is displaced between two oscillations. This change in location is converted into a very low current, that is then amplified (and converted to a voltage) by a microcontroller inside the gyroscope integrated chip.

\section{Accelerometer and gyroscope device selection}
There are a variety of MEMS accelerometers and gyroscopes available in the market
with different specifications.
At the time of this writing, the MEMS accelerometer and gyroscope
manufacturing industry is dominated by two companies:
STMicroelectronics and InvenSense.
Our purpose was to pick the most suitable device for logging wrist movement data.
We will first look at the different parameter's that we have for MEMS devices. These parameters are referenced from Analog Devices' website\footnote{\href{http://www.analog.com/en/content/td_accelerometer_specifications_definitions/fca.html}{Analog Devices - Accelerometer Specifications - Quick Definitions. Last accessed October 2014}} :

\begin{description}

\item[Output] \hfill \\
The output of the sensor can be analog or digital. For an analog device, the output is a voltage corresponding to the detected measurement. This means that an acceleration between -A$_{max}$ to +A$_{max}$ would be output as a voltage between V$_{dd}$ and V$_{cc}$. Each output would have its own pin to output a signal. A digital device on the other hand, would use some kind of communication protocol. The device usually has registers or a memory stack that can be read using a protocol like I$^2$C (also known as TWI) or SPI. Using this protocol, a master device (microcontroller) can poll the slave (sensor) to read its memory.

\item[Output data rate] \hfill \\
This defines the rate at which data is sampled and then output by the device.
In analog accelerometers,
this represents how often an accelerometer updates its output voltage in response to the measured acceleration.
In digital accelerometers,
this represents how often the register storing the value of the acceleration is updated.
Our required data rate is 15Hz for sufficiently accurate monitoring of wrist movements.

\item[Package type and size] \hfill \\
Since the device is mounted on the wrist, space and volume is at a premium.
Most MEMS devices are catered to the consumer electronics market,
thus used in small devices like mobile phones and smart watches. Due to this,
there is constant innovation in the market with regards to the size of the integrated chip's footprint.
Packages like LGA (Land Grid Array) and QFN (Quad Flat No - Lead) are used.
These packages usually lack pins and are surface mounted to reduce the footprint on a PCB.
An example of the QRN package is the IMU that we used in our device, the MPU 6000 produced by InvenSense Inc.
An image from Sparkfun.com~\cite{Image:SparkfunMPU6000}  (see figure \ref{fig:MPU6000Size}) shows the size of the chip compared to a quarter.

\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/MPU6000Size.jpg}
\caption{The MPU-6000 IMU, placed on an American Quarter to emphasize size.}
\label{fig:MPU6000Size}
\end{center}
\end{figure}

\item[Measurement range] \hfill \\
This defines the range of measurement supported by an IMU's output specifications.
For an accelerometer, the range is usually defined in g's, where 1g = 9.8 m/s\textsuperscript{2}.
This is the greatest amount of acceleration that can be measured and accurately represent as an output.
A larger acceleration maybe incorrect or capped at the maximum value.
For example, the MPU-6000 has four modes with measurement ranges from $\pm{2}$g to $\pm{16}$g.
The maximum measurement range value is not the breaking point for the device.
A higher acceleration of 17g may not break the accelerometer, but will not be reported correctly.
The minimum value of acceleration that might harm the sensor is defined as the Absolute maximum acceleration.
 
Human motions are typically contained within 2g's of acceleration.
With this fact, our options for accelerometers are fairly large
considering that most MEMS accelerometers aimed at the consumer electronics market will have a minimum measurement range of 2g's or greater. 
\hfill 
\item[Current consumption] \hfill \\
The power drained by the device is a huge factor for us.
MEMS accelerometers are fairly low power devices.
The LIS344ALH accelerometer used by Drennan~\cite{drennan2010assessment} typically consumed 650 $\mu{A}$ of current when operating and a maximum of 5 $\mu{A}$ when in sleep mode.
Gyroscopes on the other hand tend to consume a very high amount of current.
Drennan used two gyroscopes~\cite{drennan2010assessment}, each consuming 6.8mA.
This means that on a standard coin cell battery that has a size of 90 mAh,
the gyroscopes would run for about 7 hours, a very short lifetime.

\item[Number of axes] \hfill \\
As MEMS technology has improved, the sensors based on these technologies have improved.
Early accelerometers would sense acceleration across a single axis.
With current technology, most accelerometers and gyroscopes can measure motion across all three axes.
Inertial Measurement Unit's are available that pack not only an accelerometer and a gyroscope,
but also a magnetometer for more accurate motion tracking.
This multiple sensor package greatly reduces the current consumption against a scenario where multiple devices are being used, each consuming its own current.
We will not be using a magnetometer for our work as we require raw signals and not inertial movement data.
Due to this we can ignore parts with magnetometers.
\end{description}
\inputfile{tables/SensorTable.tex}
We compared a few of the options available in the market in September 2013 against the parameters discussed previously.
Table \ref{Tab:SensorCompTable} shows the different product names versus their important parameters.
The first three products were used by work done by Drennan~\cite{drennan2010assessment}.
Based on these different parameters and comparing with previous work,
we have selected the InvenSense MPU-6000.
The device contains both,
a 3-axis accelerometer and a 3-axis gyroscope.
It features three 16-bit analog-to-digital converters each for both these devices to digitize the sensor outputs.
This data is stored in internal registers that can be accessed using I$^{2}$C at 100kHz or using SPI at 1Mhz.
An on-chip buffer allows storing bursts of readings, which can be read in bursts by a master device.
The device operates at a voltage of 2.375V to 3.46V.
An operating current of 3.8mA means that the device can operate for roughly 24 hours on a standard coin cell battery.
This makes the MPU 6000 very suitable for our requirements.

\section{Breakouts}
\label{Sec:Breakouts}
Newer integrated chips are packaged very densely, and have very small pins to connect to a PCB. With surface mount technology, it is possible to solder these devices to PCB's, however it is very hard for hobbyists to do so, because of the lack of expensive equipment. Electronic part retailers provide products in the form of breakout boards, which means that they provide PCB's with the integrated chip soldered. These PCB's have pins to connect to that can be used conveniently. In effect, a breakout board converts pin - less packages like BGA (Ball grid array) and LGA (Land grid array) to DIP (Dual inline package).
\begin{figure}
\begin{center}
\includegraphics{images/MPUBreakout.jpg}
\caption{A breakout board containing the MPU 6050 chip. Quarter shown for comparison.}
\label{Fig:MPUBreakOut}
\end{center}
\end{figure}

These breakout boards are easier to prototype with, and allow modular creation of a complete circuit. Although we have selected the MPU 6000, we still have to work it into our circuit and ensure that it will work in our device. To do so, conventional methods would require us to first solder this IC to a PCB containing the other components, and then programming a microcontroller to read from the sensor. However, PCB fabrication and soldering can be expensive, and are not a viable option during the prototype phase of product design. PCB manufacture can also take a considerable amount of time (up to a month), and is not a feasible strategy to work with. To prototype and test the sensor without fabricating a complete PCB, we decided to use a breakout board containing the sensor. Figure ~\ref{Fig:MPUBreakOut} shows an example of a breakout board. The image was sourced from Sparkfuns' website~\cite{Web:SFBreakout}.

\section{Memory}
\label{Sec:Memory}

The information sensed by the sensors has to be logged, and then processed by a computer. We could either store this information or transmit it wirelessly as soon as it is gathered. For a system designed to read sensors at 15Hz, and logging data for 24 hours, we estimate the amount of data as shown in Equation \ref{Eqn:DataAmount}

\begin{equation}
\label{Eqn:DataAmount}
 \mbox{data} = 24~\mbox{hours} * \dfrac{60~\mbox{minutes}}{\mbox{hour}} * \dfrac{60~\mbox{seconds}}{\mbox{minute}} * \dfrac{15~\mbox{polls}}{\mbox{second}} * \dfrac{6~\mbox{sensors}}{\mbox{poll}} * \dfrac{1~\mbox{byte}}{\mbox{sensor~poll}}
\end{equation}

\begin{equation}
\label{Eqn:DataAmount2}
\mbox{data} = 7,776,000~\mbox{bytes} = 7,593.75~\mbox{kilobytes}
\end{equation}

We do not consider wireless transmission for our device. The device would have to transmit data to another device which it would be paired to. The paired device would need to remain in wireless connectivity range to store this data. This adds another device to our solution, so we do not consider it.

To store the 7.5 megabytes of data, we need some kind of memory. We see in \ref{Sec:MicroController} that our microcontroller only has a flash memory of 48KB. This would mean we need a memory to store the data during the interval that the user is wearing the device. This data can then be transferred to a computer from the memory once we have a connection between the two.

We compared the available options in the market. Most memory chip's are sold in power's of 2, so we would have to look at devices close to 8 megabytes or 64 megabits in design.
A search on Digikey \cite{Web:DigiKeyWebsite} while working on this thesis showed that there were very limited options in the flash memory market that would support such a high density of memory. The options were further limited by the fact that we required a small footprint that we could add to our wrist mountable device. Options typically had parallel input / output which meant they had 28 pins or more, which required a larger footprint.

Atmel's memory division re-leased AT45DB642D,
a 64-megabit 2.7V Dual interface DataFlash memory chip.
This chip would support the amount of memory we required, and ran on a single 2.7V - 3.6V supply,
similar to the operating voltage for common microcontrollers.
This chip also supported SPI, the same protocol that was being used by the sensors in our circuit.
SPI allows us to use the same bus for data communication and clock,
while using one extra line for each device's slave select pin.
Figure \ref{Fig:SPISLAVES}, courtesy of a Wikipedia user~\cite{Web:WikiCBurnett},
shows how two slave devices can connect to an SPI master.
This means that we could reduce the number of I/O pins used in our microcontroller,
and also reduce the number of tracks created on our PCB for data communication.

\begin{figure}
\begin{center}
\includegraphics{images/SPI_SLAVES.eps}
\caption{An SPI system with two slaves on the same bus.}
\label{Fig:SPISLAVES}
\end{center}
\end{figure}

The chip was made available in an unconventional CASON package,
which is a surface mount package.
This means we would have to solder the chip before it could communicate with a microcontroller.
Since it was recently released to the market,
we were not able to find a breakout board on the market for this chip.
We would have to create our own breakout board for testing.
To avoid the delay incurred because of PCB fabrication (which can take up to two weeks), we jerry rigged the chip. After flipping it upside down, so that its pins are exposed, we soldered strands of a multi strand wire to each of these pads. These strands were then soldered through a dot matrix PCB, allowing us to use the new unit as a PTH (Pin Through Hole) device. This required careful handling of the chip with a dexterous hand, and was done under a microscope. Figure \ref{Fig:CASON} shows the result of two attempts to do this. 

\begin{figure}
\begin{center}
\includegraphics[width=1.0\textwidth]{images/CASON.jpg}
\caption{Two examples of flipping over a CASON chip and soldering wires to it's pads.}
\label{Fig:CASON}
\end{center}
\end{figure}
 
\section{Microcontroller}
\label{Sec:MicroController}

The sensors we discussed in the previous section cannot function on their own. They are primarily slave devices that can be requested for data. To get this data, we require a master device, which we have in the form of a microcontroller. Our microcontroller would need to support the communication protocol used by our sensors and memory chip. It would also need to have a sufficient memory to be able to temporarily buffer sensor data before it is flushed to the external memory chip. 

Several manufacturers provide microcontrollers that we can use, however,
our priority of low current is what will separate the different microcontrollers,
and help us pick the right one for our device.
We considered the different wrist based devices on the market and realized that the MSP430 family of microcontrollers greatly dominates this market segment~\cite{lo2005body}, \cite{polastre2005telos} and \cite{werner2006deploying}.
The MSP430 Brochure \cite{instruments2009msp430} lists roughly three hundred parts that can be picked from, categorized as:

\begin{itemize}
  \item Low Power FRAM Series
  \item Value Line Series with limited components
  \item F - Family with increased integration and performance
  \item F - Family with an integrated LCD driver
  \item F - Family with high frequency operation (up to 25 Mhz)
  \item CC430 Series (Microcontroller with integrated RF chip)
\end{itemize}

When selecting our chip,
we needed one that would allow future expansion with regards to the capabilities of the wearable monitor.
SHIMMER uses the MSP430F1161~\cite{Web:ShimmerHome},
which meets most the requirements for our device. 
However, almost the entire MSP430 family is pretty close to what we might need.
Our microcontroller would need SPI or I$^2$C support so that it can communicate with the memory chip and our sensor.
The MSP430F1161 lacks any module that can communicate over the SPI protocol,
which would mean we would have to implement a software based module,
increasing the complexity of the device.
The microcontroller would also need to have a buffer large enough to store
a sizable amount of data before it would need to be flushed to the memory chip.
We found parts with SPI support and
a minimum SRAM of 2048 bytes in the MSP430F24X series. This sub-family of devices had
the following characteristics~\cite{msp430F24xfamily}:

\begin{itemize}
	\item Low Supply-Voltage Range, 1.8 V to 3.6 V
	\item Active Mode Current Consumption: 270 μA at 1 MHz, 2.2 V
	\item Standby Mode (VLO) Current Consumption: 0.3 μA
	\item Four Universal Serial Communication Interfaces supporting SPI and I$^2$C.
	\item Two 16-Bit Timers with multiple compare registers.
\end{itemize}
We select the MSP430F248 as our microcontroller. This chip comes with a 48KB+256B Flash memory, and 4KB of RAM. Assuming our program size would not be more than 1 KB, this would allow us to buffer about 3KB of data from the sensors before flushing it to the external memory, allowing the memory to remain in sleep mode for a large amount of time.

\section{MSP 430 target board}
\label{MSP430Target}

\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/QFPFoot.jpg}
\caption{The MSP430F248 integrated chip, with a quarter to show scale.}
\label{Fig:QFPFoot}
\end{center}
\end{figure}

Like our sensors, the MSP430F248 also comes in a surface mount package.
The footprint is shown in Figure \ref{Fig:QFPFoot}
and known as the QFP\footnote{Quad Flat Package} design.
This package does have pins, but they are not long enough to pass through a PCB.
Instead they have to be mounted on the PCB.
It is very hard to design a complete system without bugs, and if we would design a PCB
while writing microcontroller code at the same time,
it would not be easy to debug an error because we would not know if the error
is in the hardware design or the software code.
Also, before we can use the microcontroller,
any required external hardware needs to be connected.
This includes capacitors and resistors,
and a crystal oscillator to maintain accurate clocks.
These parts would have to be soldered to the PCB with our microcontroller.
Texas Instruments' understands that this is not a fast process for someone who wants to dive into programming the microcontroller,
so they provide a 64-Pin Target board for its microcontroller. This target board has
a ZIF\footnote{Zero Insertion Force} socket that accepts the 64-Pin QFP chip,
and breaks out its pins. This means other devices can be connected to the board with ease,
allowing us to program the microcontroller without having soldered it.
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/mspts430pm64.jpg}
\caption{The MSP430 64-Pin target board.}
\label{Fig:MSPTarget}
\end{center}
\end{figure}

Figure \ref{Fig:MSPTarget} shows us what the MSP430 Target Board \cite{Web:MSPTarget} looks like, with the socket in the center. We can see a connector in the top-right of the figure, which is labeled JTAG. The socket is surrounded by holes on all sides which connect to the microcontrollers pins, allowing for easy connections. The target board also allows for a crystal to be soldered next to the microcontroller if the programmer wants to use the low frequency clock based on an external crystal. We use this crystal for and accurate clock when polling our sensors, and also when communicating with a host computer as we will see in section \ref{Sec:FT232}.

\section{MSP430 flash emulation tool}
\label{Sec:MSP430FET}
We need a way to program the MSP430 with with our code. The MSP430 series of microcontrollers are programmed by using JTAG using 4 wires. Modern computers usually lack a serial or parallel port for communication, so Texas Instruments provides programmers with the MSP430 flash emulation tool. This tool (seen in Figure \ref{Fig:MSP430FET}) connects to a desktop computer through USB, and the other end connects to a standardized JTAG connector, as seen in \ref{Fig:MSPTarget} \cite{Web:MSPFETPAGE}. 
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/MSP430FETUIF.jpg}
\caption{The MSP430 flash emulation tool.}
\label{Fig:MSP430FET}
\end{center}
\end{figure}

The tool also supports powering the system it is programming, so we were able to program our microcontroller without an external power source. Once we had our battery selected, a jumper on the MSP430 Target Board allowed us to disable the power supply of the flash emulation tool. The FET can be used by various software, paid or free. We used IAR's Code Composer Studio to program and flash the microcontroller. Through the MSP430FET, IAR supports not only programming and flashing the microcontroller, but also debugging the code while it is running. This feature enabled us to fix multiple bugs in a short amount of time, something that would be hard to do without the debugging capabilities. The software also allowed us inspect different sections of the memory, allowing us to see live how the code is behaving.

\section{USB to UART bridge}
\label{Sec:FT232}
With the above hardware in place, hopefully we have a system which reads from sensors and stores this data in the memory chip. Once data for an entire day is logged, we would like to transfer the contents of this memory to a computer where the sensor data can be analyzed for different patterns and behaviors. Broadly speaking, there are two methods to transfer data, wireless and wired. Both these methods required parts that consume a current of about 18 mA when actively in use. Wireless transfer of data would consume power from the battery (unless a wire is connected to power the system), and assuming a speed of 115Kbps, this would take about 30 minutes to transfer. With an active current draw of 18mA for most wireless technologies, this would require a huge amount of power, something that the battery cannot sustain.
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/FT232coin.jpg}
\caption{The FT232RL USB to UART bridge.}
\label{Fig:FT232}
\end{center}
\end{figure}

We solve both these problems by using a wired connection to transfer data. As mentioned in section \ref{Sec:MSP430FET}, modern computer systems only have the USB port as a viable way to communicate. Although some MSP430 microcontrollers have native USB support, those microcontrollers have an increased current consumption and are not viable to our purpose. Our selected microcontroller, the MSP430F248, does not have a native USB module, but does have other communication modules. The MSP430F248 has a UART, and a combined I$^2$C + SPI module that can be used for communication. Since we will be using SPI for communicating with the sensors and the memory chip, using UART is a good way to isolate modules being used for different functions.

We looked for devices that would help convert communication in one protocol to another. Since SPI, I$^2$C and UART are all serial communication protocols, in theory, any device that can communicate in one of these protocols should be able to communicate in the other. However, a search on different devices in the market showed that USB to UART bridges are an easy way for microcontrollers to communicate with a computer. The device is detected as a virtual serial communication port to the operating system, and can be used as a regular serial port. Searching for USB to UART devices shows two primary contenders in the market segment, Silicon Labs and Future Technology Devices International (also known as FTDI). Both offer devices that have similar features and specifications. 

We need a device that would communicate easily with our microcontroller, the MSP430F248 and also be easy to prototype with. All of Silicon Labs' offered parts are only available in the QFN package, which means it would be harder to prototype using them. For this reason, we select FTDI's chip, the FT232RL (shown in figure \ref{Fig:FT232} \cite{Web:FTIMG}. FT232RL has the following specifications ~\cite{FT232Datasheet}:

\begin{itemize}
	\item Single chip USB to asynchronous serial data transfer interface.
	\item Data transfer rates from 300 baud to 3 Mbaud (RS422, RS485, RS232 ) at TTL levels.
	\item UART interface support for 7 or 8 data bits, 1 or 2 stop bits and odd / even / mark / space / no parity.
	\item Integrated +3.3V level converter for USB I/O.
	\item Available in compact Lead-free 28 Pin SSOP and QFN-32 packages.
\end{itemize}

The FT232 was also obtained in a breakout board for quick prototyping.
USB 2.0 had a default maximum current of 0.5mA. We add a fuse between the computer's USB module and the FT232 to make sure that voltage spikes or unwanted current draw does not harm the USB module of the computer connected to the FT232.


\section{Case}
\label{Sec:Case}
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/OKWEN.jpg}
\caption{Ergo Minitec cases manufactured by OKW Enclosures. Sizes small to large (L - R)}
\label{Fig:OKWFam}
\end{center}
\end{figure}
All these parts would need to be housed inside a box or case of some kind.
Previous work done by this group used an enclosure from OKW Enclosures.
The family of enclosures can be a seen in figure \ref{Fig:OKWFam} \cite{Web:OKWPics}.
The image shows enclosures of three sizes,
and table \ref{Tab:OKWSize} shows the sizes of the three models,
along with their Type as defined by OKW Enclosures.
Work done by Huang et al. \cite{huang2013assessment} used the Ergo Large case,
which is the largest case in the Ergo Minitec family.
Those devices were not designed to be worn all day,
but our device is meant to be worn for a full day or multiple days.
We ordered samples of all three sizes to experiment with,
and try to make our device as small as possible.
% Please add the following required packages to your document preamble:
% \usepackage{booktabs}
% \usepackage{graphicx}
\begin{table}[h]
\centering
\begin{tabular}{@{}llll@{}}
\toprule
Type & Length & Width & Height \\ \midrule
Ergo Small   & 52 mm  & 32 mm & 15 mm  \\
Ergo Medium   & 68 mm  & 42 mm & 18 mm  \\
Ergo Large   & 78 mm  & 48 mm & 20 mm  \\ \bottomrule
\end{tabular}
\caption{Comparison of sizes the Ergo Minitec case is available in.}
\label{Tab:OKWSize}
\end{table}

\section{Battery}
\label{Sec:Battery}

While the wrist activity monitor is mounted and active, it needs a power source to operate on.
SHIMMER \cite{Web:ShimmerHome} uses a single 450mah Lithium-ion Polymer battery.
Similar batteries with higher capacities are found in mobile phones. We also see other batteries available in the market,
with different characteristics based on the technology.
Our wrist motion activity monitor requires a small battery which will supply a burst current of $\approx$25mA when required.
These bursts occur when memory has to be written to or during an erase operation for a memory page,
since the memory requires higher current to process these operations.
It should also hold enough power to supply current to the system for a minimum of 24 hours.
Table \ref{Tab:BatteryCompTable} shows the different current battery types available in the market (as seen in \cite{Web:BatteryTable}), and their parameters. From this table we see that Lithium-ion and Lithium-ion Polymer batteries have identical characteristics.
The difference between the two is the electrolyte used in creating these batteries.
Lithium-ion batteries use a liquid,
while Lithium-ion Polymer batteries use a gel based electrolyte.
This allows Lithium-ion polymer batteries to be smaller,
and require less hardware in containing the electrolyte.
For slim geometry, the only choice is a Lithium-ion Polymer battery \cite{Web:BatteryTable}.
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/battcompare.eps}
\caption{Top view profiles of the compared batteries.}
\label{Fig:BattComp}
\end{center}
\end{figure}
After looking at work done by SHIMMER and our group earlier \cite{Web:ShimmerHome} \& \cite{drennan2010assessment} we decided to consider Lithium-ion batteries. Another field where Lithium-ion batteries are used is in flight. This field has requirements similar to our application, because the aircraft must be very light to allow for easy take-off and flight control. Since aerial vehicles need to have a low weight, batteries used in this application are high density and very efficient. However, these need a much larger battery, for example a 5000 mAh Lithium Polymer battery~\cite{neitzel2011mobile}. We considered the batteries used in the fields mentioned above and compared some of them. The comparison is given in table \ref{Tab:Battery2}.
\inputfile{tables/BatteryTable.tex}
A visual comparison of the different battery sizes is shown in figure \ref{Fig:BattComp}. As it can be seen, apart from the LIR2450, the battery sizes are somewhat similar,
so it may be possible to use a larger battery while still fitting our hardware in our case.
The width of the batteries would be an issue too.
As seen in section \ref{Sec:Case},
the case is curved along its median,
so a battery that was thicker could be accommodated if it was not too wide.
Empirical analysis showed that the Turnigy Nano-tech 160mAh battery
would fit with some modifications into the smallest ergo case.
These modifications included grinding the inside of the case to increase the space inside the case,
allowing a slightly thicker battery.


\section{Battery charger}
\label{Sec:BattCharger}
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/MCP73Breakout.jpg}
\caption{Breakout board with the MCP73831. Quarter shown for size comparison.}
\label{Fig:MCPCharger}
\end{center}
\end{figure}
If the device is being used similar to a wrist watch,
it is not feasible to dis-assemble the device to change or recharge the battery.
For this reason, 
we require an inbuilt battery charging system.
This battery could be charged when the wrist monitor is connected to a computer for transferring data.
Lithium Polymer batteries require a differential charge which is based on the voltage the batteries' cell holds.
These batteries should not be overcharged, 
as that can cause the battery to heat,
decrease the life cycle of the battery,
and also cause it to explode.
Kioumars et al. demonstrate a sensor to monitor heart rate and body temperature~\cite{kioumars2011atmega}
which uses the MCP73831, a miniature Lithium-Polymer charge management controller.
The MCP73831 is shown in figure \ref{Fig:MCPCharger} \cite{Web:MCPIC}.
This part accepts a voltage between 3.75V to 6V,
and outputs a charge current based on the status of the battery cell connected to it.
When the MCP73831 detects a battery is charged to its maximum capacity,
it stops supplying current to avoid harming the battery.

\section{LED}
\label{Sec:LED}
When the wrist activity monitor is worn,
the user would require some kind of feedback on its operation.
Any form of display would consume a large amount of current,
which would reduce the battery life of our device by a large magnitude.
We decided that the only indicator the device would have would be on its status.
Taking a cue from Bluetooth\texttrademark ~headsets,
we designed a system where a single light would blink to indicate its status.
To indicate that it is currently operating, it would blink for a very short period roughly every 10 seconds.
After 1KB of data was recorded to the microcontroller, it would be flushed to the memory chip,
this would require using SPI commands to store this data to the memory chip's buffer,
and issuing a special command to write this buffer to a page on the memory chip.
We empirically determined that this activity would repeat every 11.33 seconds.
Instead of blinking the LED every 10 seconds, we changed the process to turn on the LED every time the data flushing process would begin,
and turn off at the end of this process.
The result was a light that would blink every 11.33 seconds for 54 milliseconds.
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/LEDPhoto.jpg}
\caption{Photograph of the LED we used.}
\label{Fig:LEDPHOTO}
\end{center}
\end{figure}
The hardware for this light was implemented using an LED.
Since the LED is being turned on for very short periods of time, 
(the duty cycle for this operation being 0.37\%) very little power is being consumed by the LED.
For this reason, we used an LED found in our departments' lab. A photograph of the LED is seen in figure \ref{Fig:LEDPHOTO}.

\section{Button}
\label{Sec:Button}
As with any consumer electronic device, we require the option to turn our device on or off. We might also want to provide our user with the option of erasing the memory for the device. This would require some kind of button (or buttons) to allow such interaction. We consider a scheme that required one button, with a state machine behavior as given in table \ref{Tab:ButtonTable}. Based on this state machine behavior, we recognize that a single pole single throw momentarily on switch is the most convenient device for our purpose. This button can be see in figure \ref{Fig:MomButton} \cite{Web:SFEMOM}.
A momentary on button is similar to those seen on a remote, where the button switches on momentarily when pressed, and then deactivates as soon as pressure on it is released.
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/MOMButton.jpg}
\caption{Example of a momentary switch.}
\label{Fig:MomButton}
\end{center}
\end{figure}
\inputfile{tables/ButtonTable.tex}


\section{Connectors}
\label{Sec:Connectors}
Instead of soldering wires to our device (so that we can connect the JTAG cable or the USB to UART bridge to a computer), we prefer to use connectors. This allows us to disengage with ease without having to cut the cable or de-solder it from the device before it can be used. The JTAG connection required 7 pins to connect to our microcontroller, and a standard seven pin header is 17.78 mm X 4.85 mm in size. The pitch (distance between two pins) in a standard header is 0.1 inches or 2.54 mm. Since space on the PCB is at a premium, we use a smaller header instead, with a pitch of 0.059 inches or 1.50 mm. This allows us to conserve space on the PCB.
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/ConnectorWhole.JPG}
\caption{The 10 pin connector used to connect a JTAG cable to the microcontroller.}
\label{Fig:ConnectorWhole}
\end{center}
\end{figure}
Searching for connectors with a pitch of 1.50 mm showed us connectors that had housing around them.
An example of one such connector with housing can be seen in figure \ref{Fig:ConnectorWhole}.
From the datasheet of this connector \cite{Datasheet:TEConnHeader},
we see that the housing increases the thickness of the connector 2.5 times,
increases the length by 3 mm,
and the width by 2.1 mm. The connector we selected was available only in a 10 pin configuration.
To reduce this use of space, we cut the connector to its bare minimum.
The housing was cut off using an Exacto knife,
and three pins were cut off because they were not needed.
The final connector is shown in figure \ref{Fig:ConnectorBoth}.
\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{images/ConnectorBoth.JPG}
\caption{Photo showing the size difference after removing the enclosure and the original connector.}
\label{Fig:ConnectorBoth}
\end{center}
\end{figure}
For the USB connection, we required only 4 pins.
This would require a space of 9 mm X 2mm,
and could be squeezed between the other components on the PCB.
We used IC hooks to connect to the holes in the PCB,
with the hooks leading to a USB cable connected to a computer.
These hooks allowed a good connection between the PCB and the computer which would last for the 30 minutes it took to transfer memory contents.